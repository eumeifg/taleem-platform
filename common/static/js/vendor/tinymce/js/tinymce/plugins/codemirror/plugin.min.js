tinymce.PluginManager.requireLangPack("codemirror"),tinymce.PluginManager.add("codemirror",function(a,b){function c(){a.focus(),a.selection.collapse(!0),a.selection.setContent('<span class="CmCaReT" style="display:none">&#0;</span>');var c,d=tinyMCE.baseURL.indexOf("/static/");c=d>0?tinyMCE.baseURL.substring(0,d):window.location.origin;var e="?CodeMirrorPath="+a.settings.codemirror.path+"&ParentOrigin="+window.location.origin,f=a.windowManager.open({title:"HTML source code",url:b+"/source.html"+e,width:800,height:550,resizable:!0,maximizable:!0,buttons:[{text:"OK",subtype:"primary",onclick:function(){h({type:"save"})}},{text:"Cancel",onclick:function(){h({type:"cancel"})}}]}),g=f.getEl().getElementsByTagName("iframe")[0].contentWindow,h=function(a){g.postMessage(a,c)},i=function(b){if(c===b.origin){var d;if("init"===b.data.type)d={content:a.getContent({source_view:!0})},a.fire("ShowCodeEditor",d),h({type:"init",content:d.content}),a.dom.remove(a.dom.select(".CmCaReT"));else if("setText"===b.data.type){d={content:b.data.text};var e=b.data.isDirty;a.fire("SaveCodeEditor",d),a.setContent(d.content);var g=a.dom.select("span#CmCaReT")[0];if(g)a.selection.scrollIntoView(g),a.selection.setCursorLocation(g,0),a.dom.remove(g);else{var i=a.getContent(),j=i.replace('<span id="CmCaReT"></span>',"");i!==j&&a.setContent(j)}a.isNotDirty=!e,e&&a.nodeChanged()}else"closeWindow"===b.data.type&&f.close()}};f.on("close",function(){window.removeEventListener("message",i)}),window.addEventListener("message",i,!1)}a.addButton("code",{title:"Edit HTML",text:"HTML",icon:!1,onclick:c}),a.addMenuItem("code",{icon:"code",text:"Edit HTML",context:"tools",onclick:c})});